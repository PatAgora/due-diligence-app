{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Field Visibility Settings</h2>

  <form method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    {% macro render_field_group(title, fields) %}
      <h4 class="mt-5">{{ title }}</h4>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-3">
        {% for field in fields %}
        <div class="col">
          <div class="form-check border p-3 rounded shadow-sm bg-light">
            <input class="form-check-input" type="checkbox" id="{{ field }}" name="visible_fields" value="{{ field }}"
              {% if visibility.get(field, 1) %}checked{% endif %}>
            <label class="form-check-label fw-semibold"
                   for="{{ field }}"
                   data-bs-toggle="tooltip"
                   data-bs-placement="top"
                   title="{{ field.replace('_', ' ') | capitalize }}">
              {{ field.replace('_', ' ') | title }}
            </label>
          </div>
        </div>
        {% endfor %}
      </div>
    {% endmacro %}

    {{ render_field_group('ğŸ” Watchlist Fields', [
      'watchlist_name', 'watchlist_dob', 'watchlist_nationality',
      'watchlist_address', 'watchlist_document_type', 'watchlist_id_number',
      'watchlist_contact_numbers', 'watchlist_email_address'
    ]) }}

    {{ render_field_group('ğŸ‘¤ Individual Customer Fields', [
      'first_name', 'middle_name', 'last_name', 'dob', 'nationality',
      'customer_gender', 'customer_nationalities', 'customer_contact_numbers',
      'customer_email_address', 'document_type', 'id_number', 'address'
    ]) }}

    {{ render_field_group('ğŸ¢ Customer Entity Fields', [
      'entity_name', 'entity_type', 'entity_registration_number',
      'entity_country_of_incorporation', 'entity_industry', 'entity_related_persons'
    ]) }}

    {{ render_field_group('ğŸ’¸ Customer Payment Fields', [
      'payment_reference', 'payment_date', 'payment_amount', 'payment_currency',
      'payer_name', 'payer_country', 'beneficiary_name', 'beneficiary_country',
      'payment_purpose', 'payment_channel'
    ]) }}

    {{ render_field_group('âœ… Outcome Fields', [
      'match_type', 'match_probability', 'match_reasons',
      'match_explanation', 'screening_rationale'
    ]) }}

    <div class="mt-5">
      <button type="submit" class="btn btn-success">Save Changes</button>
    </div>
  </form>
</div>

<!-- Enable Bootstrap Tooltips -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.forEach(function (tooltipTriggerEl) {
      new bootstrap.Tooltip(tooltipTriggerEl);
    });
  });
</script>
{% endblock %}