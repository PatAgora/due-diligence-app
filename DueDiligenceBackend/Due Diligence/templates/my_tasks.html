{% extends "base.html" %}

{% block navbar %}
  <a class="nav-link text-secondary fw-semibold" href="{{ url_for('reviewer_dashboard') }}">
    <i class="bi bi-speedometer2"></i> Dashboard
  </a>
  {{ super() }}
{% endblock %}

{% block content %}




<h2>My Assigned Tasks</h2>

<form method="get" class="mb-3" style="display: flex; gap: 20px; flex-wrap: wrap;">
  <div>
    <label for="status" class="me-2"><strong>Filter by Status:</strong></label>
    <select name="status" id="status" onchange="this.form.submit()" class="form-select d-inline-block" style="width: 200px;">
      <option value="">-- All --</option>
      <option value="In Progress" {% if filter_status == 'In Progress' %}selected{% endif %}>In Progress</option>
      <option value="Pending Review" {% if filter_status == 'Pending Review' %}selected{% endif %}>Pending Review</option>
      <option value="Rework Required" {% if filter_status == 'Rework Required' %}selected{% endif %}>Rework Required</option>
      <option value="Completed" {% if filter_status == 'Completed' %}selected{% endif %}>Completed</option>
      <option value="Referred to SME" {% if filter_status == 'Referred to SME' %}selected{% endif %}>Referred to SME</option>
      <option value="Returned from SME" {% if filter_status == 'Returned from SME' %}selected{% endif %}>Returned from SME</option>
    </select>
  </div>

  <div>
    <label for="date" class="me-2"><strong>Filter by Date:</strong></label>
    <select name="date" id="date" onchange="this.form.submit()" class="form-select d-inline-block" style="width: 160px;">
      <option value="">-- All --</option>
      <option value="today" {% if request.args.get('date') == 'today' %}selected{% endif %}>Today</option>
      <option value="week" {% if request.args.get('date') == 'week' %}selected{% endif %}>This Week</option>
    </select>
  </div>
</form>

<table style="width: 100%; border-collapse: collapse;">
  <thead>
    <tr style="background-color: #000000; color: white;">
      <th style="padding: 10px; border: 1px solid #ccc;">Task ID</th>
      <th style="padding: 10px; border: 1px solid #ccc;">Hit Type</th>
      <th style="padding: 10px; border: 1px solid #ccc;">Total Score</th>
      <th style="padding: 10px; border: 1px solid #ccc;">Status</th>
      <th style="padding: 10px; border: 1px solid #ccc;">Last Updated</th>
      <th style="padding: 10px; border: 1px solid #ccc;">Action</th>
    </tr>
  </thead>
  <tbody>
    {% for task in tasks %}
    {% set bg_color = "#ffffff" %}
    {% if task.status == "Closed" %}
      {% set bg_color = "#e8f5e9" %}
    {% elif "Rework Required" in task.status %}
      {% set bg_color = "#fff3e0" %}
    {% elif "On Hold" in task.status %}
      {% set bg_color = "#e3f2fd" %}
    {% elif "Referred" in task.status %}
      {% set bg_color = "#fbe9e7" %}
    {% elif "Returned" in task.status %}
      {% set bg_color = "#ede7f6" %}
    {% endif %}

    <tr style="background-color: {{ bg_color }};">
      <td style="padding: 10px; border: 1px solid #ccc;">{{ task.task_id }}</td>
      <td style="padding: 10px; border: 1px solid #ccc;">{{ task.hit_type or '—' }}</td>
      <td style="padding: 10px; border: 1px solid #ccc;">{{ task.total_score or '—' }}</td>
      <td style="padding: 10px; border: 1px solid #ccc;">{{ task.status }}</td>
      <td style="padding: 10px; border: 1px solid #ccc;">
        {% if task.updated_at %}
          {{ task.updated_at.strftime('%d-%m-%Y') }}
        {% else %}
          —
        {% endif %}
      </td>
      <td style="padding: 10px; border: 1px solid #ccc;">
        <a href="{{ url_for('view_task', task_id=task.task_id) }}" class="btn btn-sm btn-primary">Review</a>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="6" style="text-align: center; padding: 15px;">No tasks found.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}